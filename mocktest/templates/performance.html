{% extends "base.html" %}

{% block header %}
<header class="site-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark sticky-top mb-3">
      <div class="container">
        <a class="navbar-brand mr-4" href="/">Web Academy</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarToggle">
          <div class="navbar-nav mr-auto">
            <a class="nav-item nav-link" href="{{ url_for('main.home') }}">Home</a>
          </div>
          <!-- Navbar Right Side -->
          <div class="navbar-nav">
              <a class="nav-item nav-link" href="{{ url_for('tests.java') }}">Java</a>
              <a class="nav-item nav-link" href="{{ url_for('tests.python') }}">Python</a>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle ml-3" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="padding: 0px;">
                  {% if current_user.image_file=='default.png' %}
                    {% if current_user.gender=='Male'%}
                      <img class="rounded-circle" style="width:40px ;height:40px" src="../static/profile_pics/male.png">
                    {% elif current_user.gender=='Female'%}
                      <img class="rounded-circle" style="width:40px ;height:40px" src="../static/profile_pics/female.png">
                    {% else %}
                      <img class="rounded-circle" style="width:40px ;height:40px" src="../static/profile_pics/other.png">
                    {% endif %}
                  {% else %}
                    <img class="rounded-circle" style="width:40px ;height:40px" src="../static/profile_pics/{{ image_file }}">
                  {% endif %}
                </a>
                <div class="dropdown-menu mt-2" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="{{ url_for('users.account') }}"><i class="bi bi-person-lines-fill pr-2"></i>Account</a>
                  <a class="dropdown-item" href="{{ url_for('users.performance') }}" style="font-weight: 500;"><i class="bi bi-graph-up pr-2"></i>Performance</a>
                  <a class="dropdown-item bg-danger text-white" href="{{ url_for('users.logout') }}" style="border-radius: 5px;"><i class="bi bi-box-arrow-left pr-2"></i>Logout</a>               
                </div>
              </li>
          </div>
        </div>
      </div>
    </nav>
  </header>
{% endblock %}

{% block content %}
<h3 class="mb-3">{{ current_user.username }}'s Overall Performance</h3>
<div id="checkJavaData"></div>
<div id="checkPythonData"></div>
{% endblock %}

{% block script %}
<script>
  //javaMarks Data
  var javaDate = [];
  var data_types = [];
  var operators = [];
  var classes = [];
  var exception = [];
  var inheritance = [];
  var threads = [];

  //pythonMarks Data
  var string = [];
  var list = [];
  var loop = []
  var basics = []
  var set = [];
  var files = [];
  var pythonDate = [];

  var java_data = JSON.parse('{{java_marks|tojson}}');
  var python_data = JSON.parse('{{python_marks|tojson}}');

  if(java_data.length != 0){
    $('#checkJavaData').append('<h5 class="h5">Java MCQ\'s Result</h5><canvas id="java-graph" class="mb-5" height="90"></canvas>');
    javaGraph();
  } 
  else {
    $('#checkJavaData').append('<div class="card text-center mb-5">\
<h5 class="card-header">\
  Java Test Result\
</h5>\
<div class="card-body">\
  <h5 class="card-title">No Data Found!</h5>\
  <p class="card-text">Looks like you didn\'t give any Java MCQ test.</p>\
  <a href='+`${window.origin}/java-practice`+' class="btn btn-primary">Take Java Test</a>\
</div>\
</div>');
  }

  if(python_data.length != 0){
    $('#checkPythonData').append('<h5 class="h5">Python MCQ\'s Result</h5><canvas id="python-graph" height="90"></canvas>');
    pythonGraph();
  } 
  else {
    $('#checkPythonData').append('<div class="card text-center">\
<h5 class="card-header">\
  Python Test Result\
</h5>\
<div class="card-body">\
  <h5 class="card-title">No Data Found!</h5>\
  <p class="card-text">Looks like you didn\'t give any Python MCQ test.</p>\
  <a href='+`${window.origin}/python-practice`+' class="btn btn-primary">Take Python Test</a>\
</div>\
</div>');
  }

  //java graph
  function javaGraph() {
    for (const marks in java_data) {
    if(java_data[marks].module=='Classes_Methods') {
      classes.push(java_data[marks].marks_obtained ); 
    }
    if(java_data[marks].module=='Data_Types_Variables_Arrays'){
      data_types.push(java_data[marks].marks_obtained); 
    }
    if(java_data[marks].module=='Operators_Control_Statements') {
      operators.push(java_data[marks].marks_obtained); 
    }
    if(java_data[marks].module=='Exception') {
      exception.push(java_data[marks].marks_obtained); 
    }
    if(java_data[marks].module=='Inheritance') {
      inheritance.push(java_data[marks].marks_obtained); 
    }
    if(java_data[marks].module=='Threads') {
      threads.push(java_data[marks].marks_obtained); 
    }
    javaDate.push(moment(java_data[marks].attempted_on).format('L'));
  } 
  var java_graph = document.getElementById('java-graph').getContext('2d');
  var javaData = {
    labels: javaDate,
    datasets: [{
      data: data_types,
      label: "Data Types, Variables & Arrays",
      backgroundColor: 'rgba(173, 255, 47, 0.2)',
      borderColor: 'rgba(173, 255, 47, 1)',
      borderWidth: 3
    }
    , {
      data: operators,
      label: "Operators & Control Statements",
      backgroundColor: 'rgba(255, 99, 132, 0.2)',
      borderColor: 'rgba(255, 99, 132, 0.2)',
      borderWidth: 3
    }, {
      data: classes,
      label: "Classes & Methods",
      backgroundColor: 'rgba(255, 159, 64, 0.2)',
      borderColor: 'rgba(255, 159, 64, 0.2)',
      borderWidth: 3
    }, {
      data: exception,
      label: "Exception",
      backgroundColor: 'rgba(255, 205, 86, 0.2)',
      borderColor: 'rgba(255, 205, 86, 0.2)',
      borderWidth: 3
    }, {
      data: inheritance,
      label: "Inheritance",
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      borderColor: 'rgba(75, 192, 192, 0.2)',
      borderWidth: 3
    }, {
      data: threads,
      label: "Threads",
      backgroundColor: 'rgba(54, 162, 235, 0.2)',
      borderColor: 'rgba(54, 162, 235, 0.2)',
      borderWidth: 3
    }]
  };
  var java = new Chart(java_graph, {
      type: 'line',
      data: javaData,
      options: {
          scales: {
              y: {
                beginAtZero: true,
                max: 40
              }
          }
      }
  });
}

  //python graph
  function pythonGraph() {
    for (const marks in python_data) {
    if(python_data[marks].module=='Python_Basics') {
      basics.push(python_data[marks].marks_obtained ); 
    }
    if(python_data[marks].module=='List'){
      list.push(python_data[marks].marks_obtained); 
    }
    if(python_data[marks].module=='Loops') {
      loop.push(python_data[marks].marks_obtained); 
    }
    if(python_data[marks].module=='Strings') {
      string.push(python_data[marks].marks_obtained); 
    }
    if(python_data[marks].module=='Tuples_Sets') {
      set.push(python_data[marks].marks_obtained); 
    }
    if(python_data[marks].module=='Regular_Expression_Files') {
      files.push(python_data[marks].marks_obtained); 
    }
    pythonDate.push(moment(python_data[marks].attempted_on).format('L'));
  } 
  console.log(pythonDate.length);
  console.log(pythonDate);
  var python_graph = document.getElementById('python-graph').getContext('2d');
  var pythonData = {
    labels: pythonDate,
    datasets: [{
      data: basics,
      label: "Python Basics",
      backgroundColor: 'rgba(173, 255, 47, 0.2)',
      borderColor: 'rgba(173, 255, 47, 1)',
      borderWidth: 3
    }
    , {
      data: string,
      label: "Strings",
      backgroundColor: 'rgba(255, 99, 132, 0.2)',
      borderColor: 'rgba(255, 99, 132, 0.2)',
      borderWidth: 3
    }, {
      data: list,
      label: "Python List",
      backgroundColor: 'rgba(255, 159, 64, 0.2)',
      borderColor: 'rgba(255, 159, 64, 0.2)',
      borderWidth: 3
    }, {
      data: loop,
      label: "Python Loops",
      backgroundColor: 'rgba(255, 205, 86, 0.2)',
      borderColor: 'rgba(255, 205, 86, 0.2)',
      borderWidth: 3
    }, {
      data: set,
      label: "Tuples & Sets",
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      borderColor: 'rgba(75, 192, 192, 0.2)',
      borderWidth: 3
    }, {
      data: files,
      label: "Regular Expression & Files",
      backgroundColor: 'rgba(54, 162, 235, 0.2)',
      borderColor: 'rgba(54, 162, 235, 0.2)',
      borderWidth: 3
    }]
  };
  var python = new Chart(python_graph, {
      type: 'line',
      data: pythonData,
      options: {
          scales: {
              y: {
                  beginAtZero: true,
                  max: 40
              },
              
          }
      }
  });
}
  </script>
{% endblock %}
